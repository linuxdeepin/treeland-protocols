<?xml version="1.0" encoding="UTF-8"?>
<protocol name="treeland_app_id_resolver_v1">
  <copyright><![CDATA[
  SPDX-FileCopyrightText: 2025 UnionTech Software Technology Co., Ltd.
  SPDX-License-Identifier: MIT
  ]]></copyright>

  <interface name="treeland_app_id_resolver_manager_v1" version="1">
    <description summary="manager for app id resolver">
      Create a resolver object. Typically exactly one privileged helper
      (a Wayland client with DBus access) binds this interface and serves
      identify requests coming from the compositor.
    </description>
    <request name="destroy" type="destructor">
      <description summary="destroy the manager"/>
    </request>
    <request name="get_resolver">
      <description summary="create/bind a resolver object">
        Create or bind a resolver object. Only one resolver may be registered
        per session. Treeland is a multi-user compositor; different user
        sessions may each register their own resolver. If a resolver is
        already bound in the same session, the compositor will report an
        error on the manager and will NOT create a new resolver object for
        this request.
      </description>
      <arg name="id" type="new_id" interface="treeland_app_id_resolver_v1"/>
    </request>
    <enum name="error">
      <entry name="resolver_already_exists" value="1"
        summary="A resolver is already registered in this session with the manager" />
    </enum>
  </interface>

  <interface name="treeland_app_id_resolver_v1" version="1">
    <description summary="app id resolver">
      The compositor sends identify_request with a unique request_id and a pidfd.
      The client must answer exactly once via respond(request_id, app_id). If
      resolution fails respond with an empty string.
    </description>
    <event name="identify_request">
      <description summary="ask client to resolve pidfd to application id"/>
      <arg name="request_id" type="uint" summary="monotonic id generated by compositor"/>
      <arg name="pidfd" type="fd" summary="pidfd referencing the target process"/>
    </event>
    <request name="respond">
      <description summary="respond with app id and sandboxEngineName (empty app_id on failure)">
        Respond to an identify_request. The sandboxEngineName must be provided and
        matches the context in which the process is running (container, sandbox, etc).
        If resolution fails, respond with an empty app_id.
      </description>
      <arg name="request_id" type="uint"/>
      <arg name="app_id" type="string"/>
      <arg name="sandboxEngineName" type="string" summary="the sandbox engine / security context name (required, non-empty)"/>
    </request>
    <request name="destroy" type="destructor">
      <description summary="destroy resolver"/>
    </request>
  </interface>
  
</protocol>

